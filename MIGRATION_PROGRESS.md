# Migration Progress Log

## Project Overview
- **Migration Name**: ES (Ensemble) to BBF (Salesforce) Data Migration
- **Start Date**: December 2024
- **Target Completion**: TBD
- **Current Phase**: UAT Testing - POC Pipeline Execution (Full 20-BAN Migration)

## Quick Status Summary
- **Overall Progress**: 80% complete
- **Last Session**: 2026-01-14 - Service_Charge and Off_Net notebooks updated with fixes and clarifications
- **Next Priority**: Continue POC pipeline execution (Service, Service_Charge, Off_Net migrations)
- **Status**: All migration notebooks updated with correct BBF field mappings. Service_Charge uses placeholder values until product mapping ready. Off_Net fixed to use SOF1__c (Order) relationship. Service migration now includes automatic Account__c population from BAN relationship after Service insert.

## Completed Work

### 2026-01-14 - Service_Charge and Off_Net Migrations Updated with Fixes
**Current Status:**
- Service_Charge migration now uses placeholder values for Product_Simple__c and Service_Type_Charge__c
- Off_Net migration fixed to use correct SOF1__c (Order) relationship instead of deprecated Implementation__c
- Created new notebook 08_es_product_mapping_export.ipynb for exporting ES products for mapping analysis

**Key Changes:**

**Service_Charge Migration (06):**
- **Product Mapping Not Ready:** Business has not provided ES Product ‚Üí BBF Product mapping yet
- **Placeholder Strategy:**
  - Product_Simple__c = "ANNUAL" (temporary placeholder)
  - Service_Type_Charge__c = "Power" (temporary placeholder)
- **Day 2 Enrichment:** Once business provides mapping, update these placeholders with actual values
- **Minimal Query:** Only fetches Id and Order.BBF_New_Id__c (no product fields needed for Day 1)
- **Name Field:** Autonumber - auto-generated by BBF, don't set on insert

**Off_Net Migration (07):**
- **Relationship Fixed:**
  - OLD (WRONG): Implementation__c ‚Üí IMPLEMENTATION_Project__c (not the Order!)
  - NEW (CORRECT): SOF1__c ‚Üí Order (correct relationship to Order object)
- **Service Lookup Population:** Off_Net.Service__c populated from SOF1__r.BBF_New_Id__c (Order's BBF Service ID)
- **Name Field:** Autonumber - auto-generated by BBF, don't set on insert
- **Only Required Field:** OwnerId (everything else optional or autonumber)

**Product Mapping Export Notebook (08):**
- **Purpose:** Export ES Products for business to create mapping
- **Query:** All active OrderItems with Product2 details
- **Output:** CSV with Product codes, families, names, and charge details
- **Analysis:** Shows unique product families, top products by volume
- **Target:** ES PRODUCTION (not UAT) to get complete product catalog
- **Usage:** Share CSV with business stakeholders for mapping decisions

**Why These Changes Matter:**
- Service_Charge can proceed with Day 1 migration using placeholders
- Product mapping can be completed in Day 2 enrichment pass
- Off_Net now correctly links to Orders via SOF1__c relationship
- Service__c lookup properly populated from Order.BBF_New_Id__c
- Product mapping export provides data needed for enrichment decisions

### 2026-01-14 - Service Migration Updated: Account Population from BAN Relationship
**Current Status:**
- Service migration now includes automatic Account__c population step
- After Services are inserted and ES update completes, a new step queries Services and populates Account__c from BAN relationship
- This happens automatically as part of the Service migration process

**Enhancement Details:**
1. **After Service Insert**: Services are created with only Billing_Account_Number__c (master-detail to BAN)
2. **After ES Update**: BBF_New_Id__c is written back to ES Order records
3. **NEW - Account Population Step**:
   - Query: `SELECT Id, Billing_Account_Number__r.Account__c FROM Service__c WHERE ES_Legacy_ID__c != null AND Account__c = null`
   - Updates: `Service.Account__c = BAN.Account__c` for all newly migrated Services
   - Result: Services now have proper Account relationship populated automatically

**Why This Matters:**
- Services need Account__c populated for proper data model relationships
- Account__c is derived from the BAN's Account relationship (BAN ‚Üí Account)
- This step ensures data integrity without requiring Account__c during initial insert
- Separates concerns: master-detail BAN relationship is required for insert, lookup Account relationship populated afterward

**Migration Notebooks Status:**
- ‚úÖ **02_account_migration**: COMPLETED (19/20 accounts migrated successfully)
- ‚úÖ **01_location_migration**: COMPLETED (31 locations migrated)
- ‚úÖ **03_contact_migration**: COMPLETED (contacts for 19 accounts migrated)
- ‚úÖ **04_ban_migration**: COMPLETED (with 2 failures due to Payment Terms picklist)
- ‚úÖ **05_service_migration**: UPDATED - Now includes Account__c population from BAN relationship after insert
- ‚úÖ **06_service_charge_migration**: UPDATED - Uses PLACEHOLDER values (Product_Simple__c="ANNUAL", Service_Type_Charge__c="Power") until business provides mapping
- ‚úÖ **07_offnet_migration**: UPDATED - Fixed to use SOF1__c (Order) relationship; populates Service__c from Order.BBF_New_Id__c
- ‚úÖ **08_es_product_mapping_export**: NEW - Exports ES products for mapping analysis (not a migration notebook)

### 2026-01-14 - Notebooks 05, 06, 07 Updated with Required-Fields-Only Mappings
**Current Status:**
- Service, Service_Charge, and Off_Net notebooks updated with Day 1 required-fields-only approach
- All field mappings now based on actual BBF metadata
- Boolean fields removed (default to False automatically)
- Field names corrected based on actual BBF org metadata

**Key Technical Changes:**
- **Service__c (05)**: Only Billing_Account_Number__c (master-detail) + ES_Legacy_ID__c on insert
  - Name is AUTONUMBER in BBF (generated automatically)
  - Service__c has no OwnerId field
  - **NEW:** Account__c populated in separate step after insert from BAN.Account__c relationship
- **Service_Charge__c (06)**: Only Name, Service__c (master-detail), Product_Simple__c, Service_Type_Charge__c, ES_Legacy_ID__c
- **Off_Net__c (07)**: Only Name, OwnerId, ES_Legacy_ID__c, Service__c (optional)
- All boolean fields removed (they default to False)
- Field names corrected based on actual BBF metadata (e.g., mrc__c not MRC__c, Circuit_Code__c not Circuit_ID__c)
- ES_Legacy_ID__c field added to Service__c, Service_Charge__c, Off_Net__c in BBF by user

**Rationale for Day 1 Required-Fields-Only Approach:**
- Reduces migration risk by minimizing data transformation complexity
- Allows migration pipeline to complete successfully without field mapping errors
- Creates foundation records that can be enriched in Day 2+ passes
- Master-detail and required picklist fields ensure proper relationships
- Optional fields (Status, Circuit IDs, MRC/NRC, Bandwidth, etc.) can be added after initial migration
- Boolean fields automatically default to False - no need to set explicitly
- Easier to troubleshoot and validate initial migration success

**Fields Handled in Service Migration:**
- **Day 1 Insert**: Billing_Account_Number__c (master-detail), ES_Legacy_ID__c
- **Day 1 Post-Insert**: Account__c (populated from BAN.Account__c relationship)
- **Automatic**: Name (autonumber generated by BBF)

**Fields Omitted for Day 2+ Enrichment:**
- Service__c: A_Location__c, Z_Location__c, Service_Status__c, Circuit_ID__c, Billing_Start_Date__c, MRC__c, NRC__c, Bandwidth__c, etc.
- Service_Charge__c: Description__c, Amount__c, Unit_Rate__c, Units__c, Start_Date__c, End_Date__c, all 11 boolean flags, **PLUS Product_Simple__c and Service_Type_Charge__c need enrichment from placeholders**
- Off_Net__c: AA_Location__c, ZZ_Location__c, Off_Net_Circuit_ID__c, COGS_MRC__c, COGS_NRC__c, Vendor details, dates, etc.

### 2026-01-14 - Session Update: Account Completed, Documentation Created
**Current Status:**
- Account migration completed successfully (19/20 accounts)
- Location migration ready to execute (about to run)
- Created comprehensive documentation for filtering logic and stakeholder decisions

**Migration Notebooks Status:**
- ‚úÖ **02_account_migration**: COMPLETED (19/20 accounts migrated successfully)
  - 19 accounts migrated to BBF successfully
  - 1 account blocked by BBF duplicate detection (common customer scenario)
  - Common customer's downstream records will be automatically filtered (no Account.BBF_New_Id__c)
  - Only Location records for common customer will exist in BBF (orphaned but harmless)
- ‚è≥ **01_location_migration**: ABOUT TO RUN (next immediate step)
- ‚è≥ **03_contact_migration**: PENDING (after Location)
- ‚è≥ **04_ban_migration**: PENDING
- ‚è≥ **05_service_migration**: PENDING
- ‚è≥ **06_service_charge_migration**: PENDING
- ‚è≥ **07_offnet_migration**: PENDING

**New Documentation Created:**
- **MIGRATION_FILTERING_GUARDRAILS.md**: Comprehensive reference document for all filtering logic across migration notebooks
  - Documents all filtering variables (TEST_MODE, MAX_ORDERS_PER_BAN, SKIP_NON_BBF_ORDERS)
  - Explains filtering behavior for each notebook
  - Provides examples of filter combinations and their effects
  - Serves as single source of truth for filtering logic
- **STAKEHOLDER_DECISION_Common_Customer_Handling.md**: Decision document for common customer scenario
  - Documents the common customer blocking issue
  - Provides decision options and recommendations
  - Will be updated with stakeholder decision when made
- **.claude/agents/migration-docs-sync.md**: New Claude agent for documentation synchronization
  - Specialized agent to keep documentation in sync with notebook code
  - Ensures MIGRATION_FILTERING_GUARDRAILS.md stays current with code changes
  - Validates consistency between notebooks and documentation

**Key Technical Accomplishments:**
- Successfully validated Account migration logic with 95% success rate (19/20)
- Confirmed duplicate detection behavior works as expected for common customers
- Demonstrated automatic downstream filtering for blocked accounts
- Created comprehensive documentation infrastructure
- Established documentation sync process with specialized agent

### 2026-01-14 - POC Pipeline Execution Started
**Action**: Started full POC pipeline execution with 20 marked BANs

**Initial Observations**:
- Account migration completed with 19/20 success rate
- Common customer (1 account) properly identified and will be filtered from downstream migrations
- Location records for common customer remain in BBF (orphaned but harmless)
- Automatic filtering mechanism working as designed

**Next Steps**:
- Execute Location migration (01)
- Execute Contact migration (03)
- Continue through remaining notebooks
- Document any issues or blockers encountered

### 2026-01-14 - UAT Account Migration Testing
**Accomplishments:**
- Executed UAT Account migration test with 20 accounts
- Successfully migrated 19 accounts to BBF org
- Validated migration logic and data transformation
- Discovered critical duplicate detection scenario

**Test Results:**
- ‚úÖ 19/20 accounts migrated successfully (95% success rate)
- ‚ö†Ô∏è 1/20 accounts blocked by BBF duplicate detection
- Identified "common customer" scenario: customers existing in both ES and BBF orgs

**Critical Discovery:**
- Some customers already exist in BBF org, causing duplicate detection blocks
- This represents a new scenario not previously accounted for in migration logic
- Requires stakeholder decision on matching/linking strategy before proceeding with full migration

### 2026-01-12 - Service Migration Notebooks Created
**Accomplishments:**
- Created Service migration notebook (initial-day/05_service_migration.ipynb)
- Created Service_Charge migration notebook (initial-day/06_service_charge_migration.ipynb)
- Created Off_Net migration notebook (initial-day/07_offnet_migration.ipynb)
- Organized migration pipeline into sequential notebooks
- Identified critical testing blocker

**Migration Notebooks Status:**
1. ‚úÖ Location Migration: `initial-day/01_location_migration.ipynb` (tested, working)
2. ‚úÖ Account Migration: `initial-day/02_account_migration.ipynb` (tested, working - UAT tested 2026-01-14)
3. ‚úÖ Contact Migration: `initial-day/03_contact_migration.ipynb` (tested, working)
4. ‚úÖ BAN Migration: `initial-day/04_ban_migration.ipynb` (created)
5. ‚ö†Ô∏è Service Migration: `initial-day/05_service_migration.ipynb` (created, cannot test)
6. ‚ö†Ô∏è Service_Charge Migration: `initial-day/06_service_charge_migration.ipynb` (created, cannot test)
7. ‚ö†Ô∏è Off_Net Migration: `initial-day/07_offnet_migration.ipynb` (created, cannot test)

**Source Files Migrated:**
- Location: `es_bbf_location_migration.ipynb` ‚Üí `initial-day/01_location_migration.ipynb`
- Account: `es_bbf_account_migration.ipynb` ‚Üí `initial-day/02_account_migration.ipynb`
- Contact: `es_bbf_contact_migration.ipynb` ‚Üí `initial-day/03_contact_migration.ipynb`
- BAN: `es_bbf_ban_migration.ipynb` ‚Üí `initial-day/04_ban_migration.ipynb`

### Earlier - Preparation & Analysis Work
**Preparation Notebooks (NOT part of migration pipeline):**
- `es_to_bbf_ban_creation_v12.ipynb` - Creates -BBF BANs in ES org (preparation step)
- `es_bbf_ban_migration_v2.ipynb` - Creates BBF accounts within ES (preparation step)
- Multiple analysis notebooks for data quality and field mapping

**Analysis Files:**
- Multiple versions of migration analysis Excel files (v1-v6)
- Data quality analysis results
- Dry run results from various migration attempts
- BBF Complete Data Model Analysis
- Migration Visual Summary

## In Progress
- **Location Migration**: About to execute Location migration (01) as next immediate step
- **POC Pipeline Execution**: Continuing full 20-BAN migration pipeline
  - Account migration COMPLETED (19/20)
  - Location migration NEXT
  - Contact migration queued after Location
  - Monitoring for errors and data quality issues
- **Common Customer Strategy**: Awaiting stakeholder decision on handling approach

## Pending/Blocked

### CRITICAL BLOCKER üö® - Common Customer Handling Strategy
**Issue**: Customers that exist in both ES and BBF orgs cause duplicate detection blocks during migration

**Status Update (2026-01-14)**:
- Decision document created: STAKEHOLDER_DECISION_Common_Customer_Handling.md
- Document outlines options and recommendations
- Awaiting stakeholder review and decision
- POC pipeline can continue with 19/20 accounts (1 common customer filtered automatically)

**Impact**: 
- Cannot proceed with FULL Account migration until resolution strategy is determined
- Affects all downstream migrations (Contacts, BANs, Services, etc.) for common customers
- Unknown scope: number of common customers across both orgs not yet quantified
- Current POC demonstrates automatic filtering works correctly

**Current Workaround for POC**:
- Affected account (1 out of 20) is automatically filtered from downstream migrations
- Orphaned Location records remain in BBF but are harmless
- Demonstrates built-in safety mechanisms of migration pipeline

**Required Action**: Stakeholder decision needed on one of the following approaches:
1. **Match & Link**: Identify matching records and link ES data to existing BBF Accounts
2. **Skip & Report**: Skip common customers during migration, generate report for manual handling
3. **Merge Strategy**: Define rules for merging ES data into existing BBF Account records
4. **Override**: Allow creation despite duplicates (not recommended)

**Technical Questions to Resolve:**
- What matching key should be used? (Name, Email, Phone, Custom ID field?)
- How precise must matching be? (Exact match vs. fuzzy matching)
- What happens to ES-specific data that doesn't exist in BBF?
- Should existing BBF data be preserved or overwritten?

### Previous Blocker - Orders in ES Org
**Issue**: Orders in ES org have NOT been moved to BBF_Ban__c records yet

**Impact**: 
- Cannot test Service migration (depends on Order ‚Üí BBF_Ban__c relationship)
- Cannot test Service_Charge migration (depends on Service records)
- Cannot test Off_Net migration (depends on Service records)
- Only Account, Location, Contact migrations can be tested currently

**Required Action**: Create and execute a script to move ES Orders to their corresponding BBF_Ban__c records

### Pending Work Items
1. ‚è≥ **Complete POC Pipeline Execution** (IN PROGRESS - Priority 1)
   - ‚úÖ Complete Account migration (02) - DONE (19/20)
   - ‚úÖ Execute Location migration (01) - DONE (31 locations)
   - ‚úÖ Execute Contact migration (03) - DONE
   - ‚úÖ Execute BAN migration (04) - DONE (with 2 picklist failures)
   - ‚è≥ Execute Service migration (05) - NEXT IMMEDIATE STEP
   - ‚è≥ Execute Service_Charge migration (06) - Will use placeholders
   - ‚è≥ Execute Off_Net migration (07) - Now using correct SOF1__c relationship
   - ‚è≥ Document results and issues

2. ‚è≥ **Common Customer Analysis** (BLOCKING - Priority 2)
   - Query both ES and BBF orgs to identify all common customers
   - Quantify scope of the common customer issue
   - Generate analysis report for stakeholders
   - Await decision on handling strategy

3. ‚è≥ **Order ‚Üí BBF_Ban__c Association** (BLOCKING - Priority 3)
   - Create script to associate existing ES Orders with BBF_Ban__c records
   - Test the association in ES org
   - Verify data integrity after association

4. ‚è≥ **Implement Common Customer Solution** (Priority 4 - depends on item 2)
   - Implement chosen matching/linking strategy
   - Update Account migration notebook with common customer logic
   - Test with UAT accounts to validate solution
   - Document the approach for future reference

5. ‚è≥ **Product Mapping for Service_Charge Enrichment** (Priority 5 - BLOCKING enrichment)
   - Run 08_es_product_mapping_export.ipynb against ES PRODUCTION
   - Share CSV export with business stakeholders
   - Business provides ES Product ‚Üí BBF Product_Simple__c mapping
   - Business provides ES Charge Type ‚Üí BBF Service_Type_Charge__c mapping
   - Create enrichment script to update placeholder values with actual mappings

6. ‚è≥ **Non-Required Field Mapping** (Priority 6)
   - Work on field mapping/translation for enrichment pass
   - Document which fields are optional vs. required
   - Create transformation logic for enrichment data

7. ‚è≥ **Agent Configuration Updates** (Priority 7)
   - Update agent configurations with correct commands
   - Document proper usage patterns
   - Create command reference guide

8. ‚è≥ **End-to-End Testing** (Priority 8 - depends on items 1-4)
   - Test complete migration pipeline from Location ‚Üí Off_Net
   - Validate data relationships across all objects
   - Document test results and any issues

9. ‚è≥ **Production Deployment Prep** (Priority 9)
   - Finalize all migration notebooks
   - Create rollback procedures
   - Document production execution plan

## Issues & Decisions Log

### 2026-01-14 - Documentation Infrastructure Created
**Action**: Created comprehensive documentation for migration filtering logic and stakeholder decisions

**Documents Created:**
1. **MIGRATION_FILTERING_GUARDRAILS.md**
   - Comprehensive reference for all filtering variables and logic
   - Documents TEST_MODE, MAX_ORDERS_PER_BAN, SKIP_NON_BBF_ORDERS
   - Explains behavior across all migration notebooks
   - Single source of truth for filtering logic

2. **STAKEHOLDER_DECISION_Common_Customer_Handling.md**
   - Documents common customer blocking issue discovered in UAT testing
   - Outlines decision options with pros/cons
   - Provides recommendations
   - Template for stakeholder decision capture

3. **.claude/agents/migration-docs-sync.md**
   - New specialized Claude agent for documentation synchronization
   - Keeps filtering documentation in sync with notebook code
   - Validates consistency between code and docs

**Rationale**: 
- Filtering logic spread across multiple notebooks needed centralized documentation
- Common customer issue required formal decision capture
- Documentation needs to stay synchronized with code changes
- Specialized agent ensures docs remain accurate

**Impact**:
- Easier onboarding for new team members
- Reduced risk of misconfiguration
- Clear audit trail for stakeholder decisions
- Automated documentation validation

### 2026-01-14 - POC Pipeline Execution Started
**Action**: Started full POC pipeline execution with 20 marked BANs

**Observations**:
- Account migration completed with 19/20 success rate
- Common customer (1 account) properly filtered from downstream migrations
- Location records for common customer remain in BBF (orphaned but harmless)
- Automatic filtering mechanism working as designed

**Next Steps**:
- Complete Location migration
- Execute Contact migration
- Continue through remaining notebooks
- Document any issues or blockers encountered

### 2026-01-14 - Common Customer Scenario Discovered
**Issue**: Discovered common customer scenario during UAT testing - some customers already exist in BBF org, causing duplicate detection blocks

**Context**: 
- During UAT testing with 20 accounts, 1 account was blocked by BBF's duplicate detection
- This indicates that certain customers exist in both ES and BBF orgs
- The scope of this issue is currently unknown (could affect many accounts)

**Impact**: 
- Blocks full-scale Account migration until handling strategy is determined
- Affects all downstream object migrations (Contacts, BANs, Services, etc.)
- May require significant rework of migration logic depending on chosen strategy

**Decision Needed**: Stakeholder decision required on matching/linking strategy:
- What matching key should be used to link ES Accounts to existing BBF Accounts?
- Should existing BBF data be preserved, merged, or overwritten?
- What is the business process for handling these common customers?

**Technical Implications**:
- May need to implement matching algorithm (fuzzy or exact)
- May need to create linking records or update external ID fields
- May need separate reporting for matched vs. migrated accounts
- Testing scope will increase significantly

**Resolution Path**:
- Created STAKEHOLDER_DECISION_Common_Customer_Handling.md document
- Awaiting stakeholder review and decision
- POC can continue with automatic filtering in place

### 2026-01-12 - Critical Dependency Discovery
**Issue**: Discovered that ES Orders are not yet associated with BBF_Ban__c records

**Impact**: This blocks testing of the entire service-related portion of the migration pipeline (Services, Service_Charges, Off_Net records)

**Decision**: Prioritize creating Order ‚Üí BBF_Ban__c association script before proceeding with further testing

**Technical Context**: 
- Service records depend on Orders being properly linked to BBF_Ban__c
- Service_Charge records depend on Service records existing
- Off_Net records depend on Service records existing
- This creates a critical path dependency that must be resolved

### Migration Pipeline Architecture Decision
**Decision**: Organize migration into sequential numbered notebooks within `initial-day/` folder

**Rationale**:
- Clear execution order (01, 02, 03, etc.)
- Separates preparation notebooks from actual migration notebooks
- Makes dependencies obvious through numbering
- Easier to run in sequence for full migration

**Structure**:
```
initial-day/
  01_location_migration.ipynb
  02_account_migration.ipynb
  03_contact_migration.ipynb
  04_ban_migration.ipynb
  05_service_migration.ipynb
  06_service_charge_migration.ipynb
  07_offnet_migration.ipynb
```

## Known Dependencies

```
Location (01) ‚è≥ ABOUT TO RUN (Next immediate step)
    ‚Üì
Account (02) ‚úÖ COMPLETED (19/20) ‚Üê Location
    ‚Üì [NOTE: Common customer handling strategy needed for full migration]
Contact (03) ‚è≥ PENDING ‚Üê Account
    ‚Üì
BAN (04) ‚è≥ PENDING ‚Üê Account
    ‚Üì
[BLOCKER: Orders must be associated with BBF_Ban__c]
    ‚Üì
Service (05) ‚è≥ PENDING ‚Üê BAN, Orders
    ‚Üì
Service_Charge (06) ‚è≥ PENDING ‚Üê Service
    ‚Üì
Off_Net (07) ‚è≥ PENDING ‚Üê Service
```

## File Inventory

### Migration Notebooks (Active)
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/initial-day/01_location_migration.ipynb`
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/initial-day/02_account_migration.ipynb`
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/initial-day/03_contact_migration.ipynb`
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/initial-day/04_ban_migration.ipynb`
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/initial-day/05_service_migration.ipynb`
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/initial-day/06_service_charge_migration.ipynb`
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/initial-day/07_offnet_migration.ipynb`

### Documentation Files (NEW - 2026-01-14)
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/MIGRATION_FILTERING_GUARDRAILS.md` - Comprehensive filtering logic reference
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/STAKEHOLDER_DECISION_Common_Customer_Handling.md` - Common customer decision document
- `/mnt/c/Users/vjero/Documents/repos/python-repo/python_scripts/ES-to-BBF-migration/.claude/agents/migration-docs-sync.md` - Documentation synchronization agent

### Preparation Notebooks (Reference Only)
- `es_to_bbf_ban_creation_v12.ipynb` - Creates -BBF BANs in ES org
- `es_bbf_ban_migration_v2.ipynb` - Creates BBF accounts in ES
- `es_bbf_BAN_split.ipynb` - BAN analysis/splitting logic
- Various versioned analysis notebooks

### Supporting Files
- `bbf_export_sf_fields.py` - Field export utility for BBF org
- `es_export_sf_fields.py` - Field export utility for ES org
- `data-migration/es_salesforce_fields.xlsx` - Field mapping reference
- Multiple analysis Excel files with migration results and data quality reports

## Session History

| Date | Duration | Focus Area | Key Accomplishments |
|------|----------|------------|---------------------|
| 2026-01-14 | ~3 hours | Service/Charge/OffNet Updates | Updated notebooks 06 and 07 with placeholder values and relationship fixes; created 08_es_product_mapping_export.ipynb; synchronized all documentation |
| 2026-01-14 | ~2 hours | Documentation & Pipeline Prep | Account migration completed (19/20); created MIGRATION_FILTERING_GUARDRAILS.md, STAKEHOLDER_DECISION_Common_Customer_Handling.md, and migration-docs-sync agent; Location migration ready to run |
| 2026-01-14 | ~1 hour | POC Pipeline Execution | Started full 20-BAN migration; Account completed (19/20); identified common customer handling as decision point |
| 2026-01-14 | ~1 hour | UAT Account Migration Testing | Tested 20 accounts (19 successful, 1 blocked); discovered common customer duplicate detection issue |
| 2026-01-12 | ~2 hours | Service Migration Notebooks | Created Service, Service_Charge, Off_Net migration notebooks; identified critical blocker with Order ‚Üí BBF_Ban__c association |
| Earlier Sessions | Multiple | Foundation & Testing | Created and tested Location, Account, Contact, BAN migration notebooks; performed extensive data analysis and dry runs |

## Next Steps (Prioritized)

### Immediate (Next Action)
1. **Execute Service Migration** üîÑ
   - Run Service migration notebook (05)
   - Verify Service records are created successfully in BBF
   - Verify Account__c is populated from BAN relationship
   - Document any errors or data quality issues

### Short-term (Today/This Session)
2. **Execute Service_Charge Migration**
   - Run Service_Charge migration notebook (06)
   - Verify Service_Charge records created with placeholder values
   - Confirm Product_Simple__c = "ANNUAL" and Service_Type_Charge__c = "Power"
   - Document success and note need for enrichment

3. **Execute Off_Net Migration**
   - Run Off_Net migration notebook (07)
   - Verify Off_Net records created successfully
   - Confirm Service__c lookup populated from SOF1__r.BBF_New_Id__c
   - Document results

4. **Run Product Mapping Export**
   - Run 08_es_product_mapping_export.ipynb against ES PRODUCTION
   - Generate CSV with all active products
   - Share with business stakeholders for mapping decisions

### Short-term (This Week)
5. **Analyze POC Results**
   - Review migration logs and error reports for all executed notebooks
   - Validate data quality in BBF org
   - Document any unexpected issues or behaviors
   - Calculate success rates for each migration step
   - Verify placeholder values in Service_Charge__c records

6. **Product Mapping Decision Meeting** üî¥ NEW
   - Share product export CSV with business stakeholders
   - Review top product families and products
   - Get business mapping for ES Product2 ‚Üí BBF Product_Simple__c
   - Get business mapping for ES Charge Type ‚Üí BBF Service_Type_Charge__c
   - Document mapping decisions

7. **Analyze Common Customer Scope** üö®
   - Query ES org for all Accounts
   - Query BBF org for all existing Accounts
   - Identify potential matches based on Name, Email, or other key fields
   - Generate report showing scope of common customer issue
   - Present findings to stakeholders for decision

8. **Stakeholder Decision Meeting** üö®
   - Present common customer issue and scope
   - Review STAKEHOLDER_DECISION_Common_Customer_Handling.md document
   - Review matching/linking strategy options
   - Get decision on preferred approach
   - Clarify matching rules and business requirements

### Medium-term (Next 1-2 Weeks)
9. **Create Service_Charge Enrichment Script** üî¥ NEW
   - Create enrichment notebook to update placeholder values
   - Query BBF Service_Charge__c WHERE Product_Simple__c = 'ANNUAL'
   - Query ES OrderItem with Product2 details
   - Apply business-provided mapping
   - Update BBF Service_Charge__c with actual Product_Simple__c and Service_Type_Charge__c values
   - Test with POC data before full enrichment

10. **Implement Common Customer Solution**
    - Update Account migration notebook with chosen strategy
    - Implement matching/linking logic
    - Add common customer reporting
    - Test with UAT accounts to validate solution

11. **Create Order ‚Üí BBF_Ban__c Association Script** (if still needed)
    - Design script to link existing ES Orders to BBF_Ban__c records
    - Test in ES org sandbox/test environment
    - Execute in ES org production
    - Verify all Orders are properly associated

### Long-term (Next 2-4 Weeks)
12. **Non-Required Field Mapping**
    - Identify optional fields for enrichment pass
    - Create transformation logic for complex field mappings
    - Document any business rules for field translations

13. **End-to-End Pipeline Testing**
    - Execute full migration from 01 ‚Üí 07
    - Validate data relationships and integrity
    - Validate enrichment updates for Service_Charge
    - Performance testing with production-scale data

14. **Production Readiness**
    - Finalize error handling in all notebooks
    - Create rollback procedures
    - Document production execution plan
    - Schedule production migration window

## Open Questions

### Critical - Awaiting Stakeholder Decision
1. **How should common customers (existing in both ES and BBF) be handled during migration?**
   - Should we match and link to existing BBF records?
   - Should we skip and handle manually?
   - Should we implement a merge strategy?
   - Decision document created: STAKEHOLDER_DECISION_Common_Customer_Handling.md

2. **What matching key should be used to link ES Accounts to existing BBF Accounts?**
   - Account Name (risk of false positives)?
   - Email address?
   - Phone number?
   - Custom external ID field?
   - Combination of fields?

3. **What is the scope of the common customer issue?**
   - How many accounts are affected?
   - Are these high-value customers?
   - Is there a pattern to which customers exist in both orgs?

### Product Mapping Questions - NEW
4. **What is the ES Product ‚Üí BBF Product_Simple__c mapping?**
   - Need business to review exported products and provide mapping
   - Affects Service_Charge enrichment priority
   - Impacts billing accuracy in BBF

5. **What is the ES Charge Type ‚Üí BBF Service_Type_Charge__c mapping?**
   - Need mapping for MRC/NRC/Usage charges
   - Required for proper billing categorization

### Technical Questions
6. What is the process for associating Orders with BBF_Ban__c records in ES org?
7. Are there any business rules for Order ‚Üí BAN association that need to be considered?
8. What is the timeline for resolving the Order association blocker?
9. Which non-required fields are highest priority for the enrichment pass?
10. What is the target date for production migration execution?

## Risk Register

| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Common customer handling complexity | **CRITICAL** | **HIGH** | Decision doc created; analyze scope immediately; get stakeholder decision; implement robust matching logic with extensive testing |
| Large number of common customers | HIGH | MEDIUM | Complete scope analysis; consider phased migration approach; implement comprehensive reporting |
| Incorrect matching logic | HIGH | MEDIUM | Implement multiple validation checks; test with UAT data; require manual review for edge cases |
| Order ‚Üí BBF_Ban__c association issues | HIGH | MEDIUM | Create robust association script with validation and rollback capability |
| Service migration data quality issues | HIGH | MEDIUM | Thorough testing after blocker resolved; data validation checks |
| Performance issues with large datasets | MEDIUM | MEDIUM | Test with production-scale data; implement batch processing |
| Missing field mappings for enrichment | MEDIUM | LOW | Document all optional fields; prioritize based on business value |
| Production migration downtime | HIGH | LOW | Plan migration window; create rollback procedures; test thoroughly |
| Documentation drift from code | MEDIUM | MEDIUM | Created migration-docs-sync agent to automate validation; regular sync checks |

---
*Last Updated: 2026-01-14 - Service_Charge and Off_Net notebooks updated with placeholder values and relationship fixes*
